<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- <link rel="icon" href="../../../../favicon.ico"> -->
    <title>Home page - Реестр</title>

    <% include ../../common/bootstrap_css.ejs %>
    <% include ../../common/font_awesome_css.ejs %>
    <link href="/bower_components/tempusdominus-bootstrap-4/build/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet">
    <link href="/navbar-top.css" rel="stylesheet">
    <link href="/scroll_table_double_rows.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-light bg-light mb-4">
        <a class="navbar-brand" href="/home">Домофон-Сервис</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <% include ../../common/full_menu.ejs %>
    </nav>

    <div class="container">
        <div class="card">
            <div class="card-header">
                Реестр
            </div>
            <div class="card-body">
                <form action="/registers/save" method="post">
                    <input type="text" hidden id="id" name="id" value="<%= typeof data != 'undefined' ? data.id : ''  %>">
                    <div class="form-row align-items-center">
                        <div class="col-auto my-1">
                            <button id="build_register" type="button" class="btn btn-info" data-toggle="tooltip" data-placement="top" title="Сформировать реестр">
                                <i class="fas fa-play fa-fw" aria-hidden="true"></i>
                            </button>
                        </div>
                        <div class="col-auto my-1">
                            <button id="download_register" type="button" class="btn btn-info" data-toggle="tooltip" data-placement="top" title="Загрузить реестр">
                                <i class="fas fa-cloud-download-alt fa-fw" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    <p>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="create_date">Дата создания</label>
                                <div class="input-group date" id="datetimepicker_create_date" data-target-input="nearest">
                                    <input type="text" name="create_date" id="create_date" class="form-control datetimepicker-input" data-target="#datetimepicker_create_date" readonly value="<%= typeof data != 'undefined' ? moment(data.create_date).format( 'DD.MM.YYYY' ) : ''  %>"/>
                                    <div class="input-group-append" data-target="#datetimepicker_create_date" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="start_date">Период с</label>
                                <div class="input-group date" id="datetimepicker_start_date" data-target-input="nearest">
                                    <input type="text" name="start_date" id="start_date" class="form-control datetimepicker-input" data-target="#datetimepicker_start_date" value="<%= typeof data != 'undefined' ? moment(data.start_date).format( 'DD.MM.YYYY' ) : ''  %>"/>
                                    <div class="input-group-append" data-target="#datetimepicker_start_date" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="end_date">Период по</label>
                                <div class="input-group date" id="datetimepicker_end_date" data-target-input="nearest">
                                    <input type="text" name="end_date" id="end_date" class="form-control datetimepicker-input" data-target="#datetimepicker_end_date" value="<%= typeof data != 'undefined' ? moment(data.end_date).format( 'DD.MM.YYYY' ) : ''  %>"/>
                                    <div class="input-group-append" data-target="#datetimepicker_end_date" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="last_modify_date">Последнее изменение</label>
                                <div class="input-group date" id="datetimepicker_last_modify_date" data-target-input="nearest">
                                    <input type="text" name="last_modify_date" id="last_modify_date" class="form-control datetimepicker-input" data-target="#datetimepicker_last_modify_date" readonly value="<%= typeof data != 'undefined' ? moment(data.last_modify_date).format( 'DD.MM.YYYY HH:mm' ) : ''  %>"/>
                                    <div class="input-group-append" data-target="#datetimepicker_last_modify_date" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                    </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row align-items-center">
                        <div class="col-auto my-1">
                            <input type="text" id="find_contract_number" name="find_contract_number" class="form-control" placeholder="Номер договора" value="">
                        </div>
                        <div class="col-auto my-1">
                            <div class="custom-control custom-checkbox mr-sm-2">
                                <input type="checkbox" class="custom-control-input" id="prolonged">
                                <label class="custom-control-label" for="prolonged">Пролонгированный</label>
                            </div>
                        </div>
                        <div class="col-auto my-1">
                            <button id="search" name="search" type="button" class="btn btn-info">
                                <i class="fas fa-search fa-fw" aria-hidden="true"></i> Искать
                            </button>
                        </div>
                        <div class="col">
                            <div class="float-right">Договоров <span class="badge badge-info"><%= tableRowsCount %></span></div>
                        </div>
                    </div>
                    <p>
                    <table class="table table-bordered table-sm" id="registerTable" name="registerTable">
                        <thead class="thead-light">
                            <tr>
                                <th scope="col" rowsspan="2" style="width: 33%;" class="text-center align-middle">Номер договора</th>
                                <th scope="col" rowsspan="2" style="width: 33%;" class="text-center align-middle">Пролонгированный договор</th>
                                <th scope="col" rowsspan="2" style="width: 32%;" class="text-center align-middle">Дата ТО с</th>
                            </tr>
                            <tr>
                                <th scope="col" style="width: 33%;" class="text-center align-middle">Дата договора</th>
                                <th scope="col" style="width: 33%;" class="text-center align-middle">Дата пролонгации</th>
                                <th scope="col" style="width: 32%;" class="text-center align-middle">Дата ТО по</th>
                            </tr>
                        </thead>
                        <tbody>
                        <% for (var cnt = 0, max = tableRows.length; cnt < max; cnt++) {%>
                            <tr class="<%= cnt % 2 ? 'table-success' : '' %>" >
                                <td style="width: 33%;" class="text-center align-middle"><%= tableRows[cnt].contract_number %></td>
                                <td style="width: 33%;" class="text-center align-middle"><%= tableRows[cnt].m_contract_number %></td>
                                <td style="width: 32%;" class="text-center align-middle"><%= tableRows[cnt].start_service %></td>
                            </tr>
                            <tr class="<%= cnt % 2 ? 'table-success' : '' %>" >
                                <td style="width: 33%;" class="text-center align-middle"><%= tableRows[cnt].create_date %></td>
                                <td style="width: 33%;" class="text-center align-middle"><%= tableRows[cnt].end_service %></td>
                                <td style="width: 32%;" class="text-center align-middle"><%= tableRows[cnt].end_service %></td>
                            </tr>
                        <%}%>
                        </tbody>
                    </table>
                    <% if (pageCount > 0) { %>
                        <nav aria-label="...">
                        <ul class="pagination text-center table_pagination">
                            <% if (currentPage == 1) { %>
                                <li class="page-item disabled">
                                    <span class="page-link">&laquo;</span>
                                </li>
                                <% } else { %>
                                    <li class="page-item">
                                        <a class="page-link" href="/registers/edit/?id=<%= data.id %>">&laquo;
                                    </a>
                                </li>
                            <% } %>
                            <% var i = (Number(currentPage) > 5 ? Number(currentPage) - 4 : 1) %>
                            <% if (i !== 1) { %>
                                <li class="page-item disabled">
                                    <a class="page-link">...</a>
                                </li>
                            <% } %>
                            <% for (; i <= (Number(currentPage) + 4) && i <= pageCount; i++) { %>
                                <% if (i == currentPage) { %>
                                    <li class="page-item active">
                                        <span class="page-link">
                                            <%= i %>
                                            <span class="sr-only">(current)</span>
                                        </span>
                                    </li>
                                <% } else { %>
                                    <li class="page-item">
                                        <a class="page-link" href="/registers/edit/?id=<%= data.id %><%= (i == 1) ? '' : '&offset=' + ((i - 1) * Number(visibleRows)) %>">
                                            <%= i %>
                                        </a>
                                    </li>
                                <% } %>
                                <% if (i == Number(currentPage) + 4 && i < pageCount) { %>
                                    <li class="page-item disabled">
                                        <a class="page-link">...</a>
                                    </li>
                                <% } %>
                            <% } %>
                            <% if (currentPage == pageCount) { %>
                                <li class="page-item disabled">
                                    <a class="page-link">&raquo;</a>
                                </li>
                            <% } else { %>
                                <li class="page-item">
                                    <a class="page-link" href="/registers/edit/?id=<%= data.id %><%= '&offset=' + ((pageCount - 1) * Number(visibleRows)) %>">&raquo;</a>
                                </li>
                            <% } %>
                         </ul>
                         </nav>
                      <% } %>
                    <div class="row">
                        <div class="col">
                            <button type="submit" class="btn btn-success" id="save">Записать</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="/bower_components/bootstrap/assets/js/vendor/popper.min.js"></script>
    <script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="/bower_components/moment/min/moment-with-locales.min.js"></script>
    <script src="/bower_components/tempusdominus-bootstrap-4/build/js/tempusdominus-bootstrap-4.min.js"></script>
    
    <script>

      var app = {
        Register: function() {
          this.init = function() {
            this.getAllPagination();
          };

          this.getAllPagination = function() {
            console.log('123');
          }
        }
      }

      $(function () {
        $('#datetimepicker_create_date').datetimepicker({
          format: 'L',
          locale: 'ru'
        });

        $('#datetimepicker_start_date').datetimepicker({
          format: 'L',
          locale: 'ru'
        });

        $('#datetimepicker_end_date').datetimepicker({
          format: 'L',
          locale: 'ru'
        });

        $('#datetimepicker_last_modify_date').datetimepicker({
          locale: 'ru'
        });

        $('[data-toggle="tooltip"]').tooltip()

        var register = new app.Register();
        register.init();
      });
    </script>
</body>

</html>